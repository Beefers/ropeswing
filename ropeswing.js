"use strict";(()=>{var H=Object.defineProperty;var $=(e,t)=>{for(var o in t)H(e,o,{get:t[o],enumerable:!0})};var v=["a","b","i"],c=new Map;function O(e,t,o,n,s){let r=c.get(t)?.[e];if(!r)return s?Reflect.construct(t[e],o,n):t[e].apply(n,o);for(let i of r.b.values()){let p=i.call(n,o);Array.isArray(p)&&(o=p)}let a=[...r.i.values()].reduce((i,p)=>(...h)=>p.call(n,h,i),(...i)=>s?Reflect.construct(r.o,i,n):r.o.apply(n,i))(...o);for(let i of r.a.values())a=i.call(n,o,a)??a;return a}function j(e,t,o,n){let s=c.get(e),r=s?.[t];return r?.[n].has(o)?(r[n].delete(o),v.every(a=>r[a].size===0)&&(Reflect.defineProperty(e,t,{value:r.o,writable:!0,configurable:!0})||(e[t]=r.o),delete s[t]),Object.keys(s).length==0&&c.delete(e),!0):!1}var w=e=>(t,o,n,s=!1)=>{if(typeof o[t]!="function")throw new Error(`${t} is not a function in ${o.constructor.name}`);c.has(o)||c.set(o,{});let r=c.get(o);if(!r[t]){let p=o[t];r[t]={o:p,b:new Map,i:new Map,a:new Map};let h=(m,l,u)=>{let B=O(t,o,l,m,u);return s&&i(),B},E=new Proxy(p,{apply:(m,l,u)=>h(l,u,!1),construct:(m,l)=>h(p,l,!0),get:(m,l,u)=>l=="toString"?p.toString.bind(p):Reflect.get(m,l,u)});Reflect.defineProperty(o,t,{value:E,configurable:!0,writable:!0})||(o[t]=E)}let a=Symbol(),i=()=>j(o,t,a,e);return r[t][e].set(a,n),i};var oe=w("b"),R=w("i"),ne=w("a");var _={};$(_,{clear:()=>W,typewrite:()=>q,write:()=>b,writeLine:()=>f});var x={};$(x,{timer:()=>g});var g=e=>new Promise(t=>setTimeout(t,e));var y=document.getElementById("convga");if(!y)throw new Error("Failed to find VGA console element - are we on the right site?");var W=()=>y.innerHTML="",b=(...e)=>y.textContent+=e.join(" "),f=(...e)=>b(e.join(" ")+`
`),q=async(e,...t)=>{for(let o of t.join(" ").split(""))b(o),await g(e)};var C={patches:[{executable:"C:/system/local/bin/shell36",find:/document\.addEventListener\("keydown",/,replace:()=>"("}],manifest:{name:"forcereboot",description:"Removes the reboot confirmation when pressing Ctrl+R or F5",authors:["redstonekasi"]}};var S={patches:[{find:/\(await\(0,.{1,2}\..{1,2}\)\(i\.value\)\)\.valid/,replace:"true"},{find:"the product key you have received on Patreon",replace:e=>`<s>${e}</s> any product key`}],manifest:{name:"keygen",description:"makes the keymgr app (patreon rewards app) accept any key",authors:["Beef"]}};var F={patches:[{find:/{caption:"System Flags",icon:await (.{1,2}\..{1,2}\.getIconUrl)\("objects\/tools"\),onclick:\(\)=>(.{1,2}\..{1,2}\.execCmd)\("flags"\)}/,replace:(e,t,o)=>`${e},{category:"ropeswing"},{caption:"Settings",icon:await ${t}("apps/settings"),onclick:()=>${o}("ctrl", ["--cpl", "ropeswing"])}`},{find:"rcon:k",replace:e=>`${e},ropeswing:$self.applet(__string_require__("Application not found").QP)`}],manifest:{name:"royalmail",description:"settings frontend for ropeswing",authors:["Beef"]},applet:e=>class extends e{constructor(){super()}async main(o){if(super.main(o))return;this.createWindow({taskbar:!1,center:!0,bodyClass:"ropeswing-applet",initialWidth:320,initialHeight:340,resizable:!1,controlBoxStyle:"WS_CBX_CLOSE",title:"ropeswing",body:'<div style="color: red">TODO!</div>'},!0).show()}}};var M={patches:[{find:/run\(await .+?\((.)\)/,replace:(e,t)=>`run(await $self.getFileContent(${t})`}],manifest:{name:"treebranch",description:"ropeswing in userland",authors:["redstonekasi"]},async getFileContent(e){let t=await w96.FS.readstr(e);for(let o of d)for(let n of o.patches)n.executable===e&&(t=t.replace(n.find,k(n.replace,o.manifest.name)));return t}};var T={patches:[{find:/var __webpack_exports__=__webpack_require__\(\d{4}\)/,replace:e=>`${e};$self.unpack(__webpack_require__,__webpack_modules__);`}],manifest:{name:"unbox",description:"webpack unpacker",authors:["Beef"]},unpack(e,t){window.__string_require__=o=>{for(let[n,s]of Object.entries(t)){let r=s.toString();if(o instanceof RegExp&&o.test(r)||typeof o=="string"&&r.includes(o))return e(n)}}}};var L={patches:[{find:/Windows 96 main<br>/,replace:e=>`${e}ropeswing 1079953<br>`}],manifest:{name:"version",description:"show ropeswing version info on desktop",authors:["redstonekasi"]}};var d=[C,S,F,M,T,L];function k(e,t){let o=`ropeswing.extensions["${t}"]`;switch(typeof e){case"string":return e.replaceAll("$self",o);case"function":return(...n)=>e(...n).replaceAll("$self",o)}}function I(e){if(!e.textContent)throw new Error("Script doesn't have textContent, what?");console.group("[ ropeswing-patcher ]");for(let t of d)for(let o of t.patches)o.executable||(e.textContent=e.textContent.replace(o.find,k(o.replace,t.manifest.name)),console.log(`applied patch ${t.patches.indexOf(o)+1} of ${t.patches.length} from ${t.manifest.name}`));console.groupEnd()}var A=()=>({console:_,utils:x,extensions:Object.fromEntries([...d].map(e=>[e.manifest.name,{...e}]))});console.group("[ ropeswing ]");console.log("in kernel ctx...");var z=R("appendChild",document.head,(e,t)=>{z(),e[0]instanceof HTMLScriptElement||t(...e);let o=e[0];f("[ropeswing] preboot loaded. welcome!"),f("exposing API..."),window.ropeswing=A(),f("applying patches..."),I(o),f("booting original!"),t(...e)});console.log("kernel done!");console.groupEnd();})();
//# sourceURL=ropeswing
